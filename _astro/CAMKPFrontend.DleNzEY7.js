import{d as F,r as _,c as z,w as X,o as n,a,b as e,e as A,f as d,t as o,F as I,g as S,n as T,p as ee,h as te,i as j,v as P,j as Q,k as se}from"./runtime-dom.esm-bundler.NfPSTE8u.js";function w(h){const l=h.toLowerCase();return l.startsWith("http://ctdbase.org/detail.go?type=relationship&ixnid=")?"CTD.REL:"+h.substring(53):l.startsWith("http://model.geneontology.org/")?"GO.MODEL:"+h.substring(30):l.startsWith("https://noctua.apps.renci.org/model/aop_")?"AOP:"+h.substring(40):h}const G=(h,l)=>{const i=h.__vccOpts||h;for(const[s,f]of l)i[s]=f;return i},oe=F({__name:"DisplayCAM",props:{automatCAMKPEndpoint:{default:"https://automat.renci.org/cam-kp"},selectedModelURL:{},searchIds:{}},setup(h,{expose:l}){l();const i=h,s=_(!1),f=_([]),p=_([]),t=_({}),c=_({}),M=z(()=>[...new Set(p.value.map(g=>g[0]).sort())]),x=z(()=>[...new Set(p.value.map(g=>g[1]).sort())]);function D(g,R){return p.value.filter(v=>v[0]==g&&v[1]==R).map(v=>v[3]?`${v[2]} [${v[3]}]`:v[2]).sort()}X(()=>i.selectedModelURL,(g,R)=>{g&&(f.value=[],p.value=[],t.value={},c.value={},N(g).then(v=>{f.value=v,v.map(m=>{p.value.push([m[0].id,m[2].id,m[3],m[4]]),t.value[m[0].id]=m[0].name,t.value[m[2].id]=m[2].name,c.value[m[0].id]=m[0].description,c.value[m[2].id]=m[2].description})}))});async function N(g){if(!g)return[];s.value=!0;const R=i.automatCAMKPEndpoint+"/cypher";let m=await(await fetch(R,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:`MATCH (s)-[p]-(o) WHERE '${g}' IN p.xref RETURN DISTINCT s, p, o, TYPE(p) AS pred_type, CASE
    WHEN startNode(p) = s THEN ''
    WHEN endNode(p) = s THEN 'reverse'
    ELSE ''
  END AS direction;`})})).json();s.value=!1;const k=m.results.flatMap(C=>C.data).map(C=>C.row);return console.log(k),k}const L={props:i,downloadInProgress:s,modelRows:f,spos:p,labels:t,descriptions:c,fromIds:M,toIds:x,getPredicates:D,getModelRows:N,get urlToID(){return w}};return Object.defineProperty(L,"__isScriptSetup",{enumerable:!1,value:!0}),L}}),r=h=>(ee("data-v-84ba77f1"),h=h(),te(),h),le={class:"col-8"},ne={key:0,class:"card my-2"},ae=r(()=>e("div",{class:"card-header"}," No model selected. Please search for one using the controls on the left. ",-1)),ce=[ae],de={key:1,class:"card my-2"},ie={class:"card-header"},re=["href"],ue={id:"edges",class:"card my-2"},he={class:"card-header"},_e=r(()=>e("strong",null,"Edges in selected CAM:",-1)),pe=["href"],me=r(()=>e("a",{href:"#relationships"},"Relationships",-1)),be={key:0,class:"card-body"},fe={class:"table table-bordered mb-2"},ge=r(()=>e("thead",null,[e("tr",null,[e("th",null,"Subject"),e("th",null,"Edge"),e("th",null,"Object")])],-1)),ve=r(()=>e("br",null,null,-1)),Ce=r(()=>e("br",null,null,-1)),ye=r(()=>e("em",null,"Description",-1)),Ee=r(()=>e("br",null,null,-1)),Me=r(()=>e("em",null,"Information Content",-1)),Ie=r(()=>e("br",null,null,-1)),Se=r(()=>e("em",null,"Equivalent identifiers",-1)),Re={key:0},Ue=r(()=>e("br",null,null,-1)),Ae={class:"overflow-auto",style:{height:"20em"}},je=["href"],Pe=r(()=>e("br",null,null,-1)),Oe=r(()=>e("br",null,null,-1)),Te=r(()=>e("em",null,"Description",-1)),Ne=r(()=>e("br",null,null,-1)),Le=r(()=>e("em",null,"Information Content",-1)),ke=r(()=>e("br",null,null,-1)),xe=r(()=>e("em",null,"Equivalent identifiers",-1)),De={class:"col-12"},Ve={id:"relationships",class:"card my-2"},He={class:"card-header"},Ke=r(()=>e("strong",null,"Relationships in selected CAM:",-1)),$e=["href"],Be=r(()=>e("a",{href:"#edges"},"Edges",-1)),qe={key:0,class:"card-body"},We={class:"table-responsive"},we={class:"table table-bordered table-hover"},Fe=r(()=>e("th",{scope:"col"},"From CURIE",-1)),Ge=["title"],Ye=r(()=>e("br",null,null,-1)),Je=r(()=>e("br",null,null,-1)),ze=r(()=>e("br",null,null,-1));function Qe(h,l,i,s,f,p){return n(),a(I,null,[e("div",le,[i.selectedModelURL?A("",!0):(n(),a("div",ne,ce)),s.downloadInProgress?(n(),a("div",de,[e("div",ie,[d(" Download of CAM "),e("a",{target:"cam",href:i.selectedModelURL},o(i.selectedModelURL),9,re),d(" in progress ... ")])])):A("",!0),e("div",ue,[e("div",he,[_e,d(),e("a",{target:"cam",href:i.selectedModelURL},o(i.selectedModelURL),9,pe),d(" ("),me,d(") ")]),s.downloadInProgress?A("",!0):(n(),a("div",be,[e("table",fe,[ge,e("tbody",null,[(n(!0),a(I,null,S(s.modelRows,t=>(n(),a("tr",null,[e("td",{class:T(t[0].equivalent_identifiers.some(c=>i.searchIds.has(c))?"bg-success-subtle":"")},[e("strong",null,o(t[0].id),1),d(" "+o(t[0].name),1),ve,Ce,ye,d(": "+o(t[0].description),1),Ee,Me,d(": "+o(t[0].information_content),1),Ie,Se,d(": "+o(t[0].equivalent_identifiers),1)],2),e("td",null,[e("strong",null,[d(o(t[3]),1),t[4]?(n(),a("span",Re," ["+o(t[4])+"]",1)):A("",!0)]),Ue,d(" biolink:primary_knowledge_source: "+o(t[1]["biolink:primary_knowledge_source"])+" ",1),e("ul",Ae,[(n(!0),a(I,null,S(t[1].xref,c=>(n(),a("li",{key:c},[e("a",{href:c,target:"xref"},o(s.urlToID(c)),9,je)]))),128))])]),e("td",{class:T(t[2].equivalent_identifiers.some(c=>i.searchIds.has(c))?"bg-success-subtle":"")},[e("strong",null,o(t[2].id),1),d(" "+o(t[2].name),1),Pe,Oe,Te,d(": "+o(t[2].description),1),Ne,Le,d(": "+o(t[2].information_content),1),ke,xe,d(": "+o(t[2].equivalent_identifiers),1)],2)]))),256))])])]))])]),e("div",De,[e("div",Ve,[e("div",He,[Ke,d(),e("a",{target:"cam",href:i.selectedModelURL},o(i.selectedModelURL),9,$e),d(" ("),Be,d(") ")]),s.downloadInProgress?A("",!0):(n(),a("div",qe,[e("div",We,[e("table",we,[e("thead",null,[e("tr",null,[Fe,(n(!0),a(I,null,S(s.toIds,t=>(n(),a("th",{scope:"col",class:T(i.searchIds.has(t)?"bg-success-subtle":"")},[e("span",{title:s.descriptions[t]},o(t),9,Ge),Ye,d(o(s.labels[t]),1)],2))),256))])]),e("tbody",null,[(n(!0),a(I,null,S(s.fromIds,t=>(n(),a("tr",null,[e("td",{class:T(i.searchIds.has(t)?"bg-success-subtle":"")},[e("strong",null,o(t),1),d(" "+o(s.labels[t]),1),Je,d(o(s.descriptions[t]),1)],2),(n(!0),a(I,null,S(s.toIds,c=>(n(),a("td",{class:T(i.searchIds.has(c)||i.searchIds.has(t)?"bg-success-subtle":"")},[(n(!0),a(I,null,S(s.getPredicates(t,c),M=>(n(),a("span",null,[d(o(M),1),ze]))),256))],2))),256))]))),256))])])])]))])])],64)}const Xe=G(oe,[["render",Qe],["__scopeId","data-v-84ba77f1"]]),Ze=F({__name:"SearchCAMs",props:{automatCAMKPEndpoint:{default:"https://automat.renci.org/cam-kp"},changeSelectedModel:{},changeSearchIds:{}},setup(h,{expose:l}){l();const i=h,s=_(""),f=_([]),p=_({}),t=_([]);X(f,(C,U)=>{p.value={},t.value=[],C.forEach(E=>{(E.urls||[]).forEach(y=>{p.hasOwnProperty(y)||(p.value[y]=[]),p.value[y].push(E)})}),console.log("resultsByURL = ",p),t.value=Object.entries(p.value).sort((E,y)=>y[1].length-E[1].length).map(E=>E[0]),console.log("modelURLs = ",t)});const c=_(""),M=_(""),x=_(""),D=_(""),N=_(""),L=_(100),g=_([]),R=_(!1);async function v(){R.value=!0,g.value=[];const C=c.value.split(/\s*,\s*/).filter(b=>b),U=M.value.split(/\s*,\s*/).filter(b=>b),E=D.value.split(/\s*,\s*/).filter(b=>b),y=x.value.split(/\s*,\s*/).filter(b=>b),V=new Set([...C,...U,...E,...y]);i.changeSearchIds(V);try{const b=await m(C,U,E,y,N.value,L.value);console.log(`Got ${b.length} CAM models: `,b),f.value=b}catch(b){g.value=b.message.split(`
`)}R.value=!1}async function m(C=[],U=[],E=[],y=[],V="",b=100){const H=[],K=[],$=[];if(C.length>0&&(U.length>0||y.length>0))throw new Error(`searchModels() cannot be called with both subjectOrObjectCURIEs (${C.length}) and either subjectCURIEs (${U.length}) or objectCURIEs (${y.length}).`);U&&H.push(...U.map(u=>`'${u}' IN s.equivalent_identifiers`)),y&&K.push(...y.map(u=>`'${u}' IN o.equivalent_identifiers`)),C&&$.push(...C.map(u=>`'${u}' IN s.equivalent_identifiers OR '${u}' IN o.equivalent_identifiers`));const B=[];E&&B.push(...E.map(u=>`TYPE(p) = '${u}'`));const O=[];H.length>0&&O.push(H.map(u=>`(${u})`).join(" OR ")),K.length>0&&O.push(K.map(u=>`(${u})`).join(" OR ")),B.length>0&&O.push(B.map(u=>`(${u})`).join(" OR ")),$.length>0&&O.push($.map(u=>`(${u})`).join(" AND ")),V&&O.push(`(ANY(url IN p.xref WHERE url STARTS WITH '${V.replaceAll("'","")}'))`);let q=`MATCH (s)-[p]-(o) RETURN DISTINCT p.xref, s, o, TYPE(p) AS pred_type LIMIT ${b}`;const Y=O.join(" AND ");Y.length>0&&(q=`MATCH (s)-[p]-(o) WHERE ${Y} RETURN DISTINCT p.xref, s, o, TYPE(p) AS pred_type LIMIT ${b}`),console.log("Querying Cypher:",q);const Z=i.automatCAMKPEndpoint+"/cypher";let W=await(await fetch(Z,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:q})})).json();if(W.errors.length>0)throw Error(W.errors.map(u=>u.message).join(`
`));const J=W.results[0].data.flatMap(u=>({id:w(u.row[0][0]),urls:u.row[0],subj:u.row[1],obj:u.row[2],predicate:u.row[3]}));return console.log("rows",J),J}const k={props:i,selectedModelURL:s,results:f,resultsByURL:p,modelURLs:t,subjectOrObjectCURIEsCSV:c,subjectCURIEsCSV:M,objectCURIEsCSV:x,predicateCURIEsCSV:D,modelStartsWith:N,limit:L,errors:g,inProgress:R,updateModelList:v,searchModels:m,get urlToID(){return w}};return Object.defineProperty(k,"__isScriptSetup",{enumerable:!1,value:!0}),k}}),et={class:"col-4"},tt={class:"card my-2"},st=e("div",{class:"card-header"},[e("strong",null,"Search CAM models")],-1),ot={class:"card-body"},lt={key:0,class:"mb-3 p-1 border-1 bg-danger-subtle"},nt={class:"mb-3"},at=e("label",{for:"predicateCURIEs",class:"form-label"},"Predicate CURIEs",-1),ct={class:"mb-3"},dt=e("label",{for:"subjectOrObjectCURIEs",class:"form-label"},"Subject or Object CURIEs (items will be ANDed)",-1),it={class:"mb-3"},rt=e("label",{for:"subjectCURIEs",class:"form-label"},"Subject CURIEs",-1),ut={class:"mb-3"},ht=e("label",{for:"objectCURIEs",class:"form-label"},"Object CURIEs",-1),_t={class:"mb-3"},pt=e("label",{for:"modelStartsWith",class:"form-label"},"Model starts with",-1),mt=e("ul",null,[e("li",null,"Examples"),e("ul",{class:"small"},[e("li",null,[d("GO: "),e("code",null,"http://model.geneontology.org/")]),e("li",null,[d("CTD: "),e("code",null,"http://ctdbase.org/detail.go?type=relationship&ixnId=")]),e("li",null,[d("AOP: "),e("code",null,"https://noctua.apps.renci.org/model/AOP_")])])],-1),bt={class:"mb-3"},ft=e("label",{for:"limit",class:"form-label"},"Limit",-1),gt=e("em",null,"Search in progress",-1),vt=[gt],Ct={class:"card my-2"},yt={class:"card-header"},Et={class:"card-body p-0"},Mt={class:"table table-bordered"},It=e("thead",null,[e("tr",null,[e("th",null,"Edges")])],-1),St=["onClick"],Rt=["href"],Ut=e("a",{href:"#edges"},"Edges",-1),At=e("a",{href:"#relationships"},"Relationships",-1),jt={key:0},Pt={key:0};function Ot(h,l,i,s,f,p){return n(),a("div",et,[e("div",tt,[st,e("div",ot,[s.errors.length>0?(n(),a("div",lt,[e("ul",null,[(n(!0),a(I,null,S(s.errors,t=>(n(),a("li",null,o(t),1))),256))])])):A("",!0),e("div",nt,[at,j(e("input",{type:"text",class:"form-control",id:"predicateCURIEs",placeholder:"biolink:affects, biolink:affected_by","onUpdate:modelValue":l[0]||(l[0]=t=>s.predicateCURIEsCSV=t)},null,512),[[P,s.predicateCURIEsCSV]])]),e("div",ct,[dt,j(e("input",{type:"text",class:"form-control",id:"subjectOrObjectCURIEs",placeholder:"PUBCHEM.COMPOUND:5865, NCBIGene:2944","onUpdate:modelValue":l[1]||(l[1]=t=>s.subjectOrObjectCURIEsCSV=t)},null,512),[[P,s.subjectOrObjectCURIEsCSV]])]),e("div",it,[rt,j(e("input",{type:"text",class:"form-control",id:"subjectCURIEs",placeholder:"CHEMBL.COMPOUND:CHEMBL158, PUBCHEM.COMPOUND:5742832","onUpdate:modelValue":l[2]||(l[2]=t=>s.subjectCURIEsCSV=t)},null,512),[[P,s.subjectCURIEsCSV]])]),e("div",ut,[ht,j(e("input",{type:"text",class:"form-control",id:"objectCURIEs",placeholder:"CHEMBL.COMPOUND:CHEMBL158, PUBCHEM.COMPOUND:5742832","onUpdate:modelValue":l[3]||(l[3]=t=>s.objectCURIEsCSV=t)},null,512),[[P,s.objectCURIEsCSV]])]),e("div",_t,[pt,mt,j(e("input",{type:"text",class:"form-control",id:"modelStartsWith","onUpdate:modelValue":l[4]||(l[4]=t=>s.modelStartsWith=t)},null,512),[[P,s.modelStartsWith]])]),e("div",bt,[ft,j(e("input",{type:"text",class:"form-control",id:"limit","onUpdate:modelValue":l[5]||(l[5]=t=>s.limit=t)},null,512),[[P,s.limit]])]),s.inProgress?(n(),a("a",{key:1,onClick:l[6]||(l[6]=t=>s.updateModelList()),class:"btn btn-primary"},vt)):(n(),a("a",{key:2,onClick:l[7]||(l[7]=t=>s.updateModelList()),class:"btn btn-primary"},"Search"))])]),e("div",Ct,[e("div",yt,[e("strong",null,"Found "+o(s.results.length)+" results from "+o(s.modelURLs.length)+" models",1)]),e("div",Et,[e("table",Mt,[It,e("tbody",null,[(n(!0),a(I,null,S(s.modelURLs,t=>(n(),a("tr",{onClick:c=>{s.selectedModelURL=t,i.changeSelectedModel(t)}},[e("td",{class:T(s.selectedModelURL===t?"table-active":"")},[d(o(s.urlToID(t))+" ("+o(s.resultsByURL[t].length)+" results, ",1),e("a",{href:t,target:"model-url"},"URL",8,Rt),d(", "),Ut,d(", "),At,d(") "),(n(!0),a(I,null,S(s.resultsByURL[t],c=>(n(),a("ul",null,[c.subj?(n(),a("li",jt,[d(o(c.subj.id)+' ("'+o(c.subj.name)+'") ',1),e("ul",null,[e("li",null,o(c.predicate),1),c.obj?(n(),a("li",Pt,o(c.obj.id)+' ("'+o(c.obj.name)+'")',1)):A("",!0)])])):A("",!0)]))),256))],2)],8,St))),256))])])])])])}const Tt=G(Ze,[["render",Ot]]),Nt=F({__name:"CAMKPFrontend",setup(h,{expose:l}){l();const i=_("https://automat.renci.org/cam-kp"),s=_(""),f=_(new Set);function p(M){s.value="",s.value=M}function t(M){f.value=M}const c={automatCAMKPEndpoint:i,selectedModelURL:s,searchIds:f,changeSelectedModel:p,changeSearchIds:t,DisplayCAM:Xe,SearchCAMs:Tt};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}}),Lt=se('<div class="card my-2"><div class="card-header"><strong>CAM-KP Frontend</strong></div><div class="card-body"><p class="card-text"> The CAM-KP Frontend is intended to provide a frontend to the <a href="https://github.com/NCATSTranslator/Translator-All/wiki/CAM-Provider-KG">Causal Activity Models (CAM) Knowledge Graph (KG)</a>, as implemented in <a href="https://automat.renci.org/#/cam-kp">Automat CAM-KP</a>. </p><p class="card-text"><strong>Experimental and under development.</strong> Please report any issues to <a href="https://github.com/ExposuresProvider/cam-pipeline/issues">our GitHub repository</a>. </p></div></div>',1),kt={class:"row"},xt={class:"accordion",id:"advancedOptionsAccordion"},Dt={class:"accordion-item"},Vt=e("h2",{class:"accordion-header",id:"advancedOptionsHeader"},[e("button",{class:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#advancedOptions","aria-expanded":"false","aria-controls":"advancedOptions"}," Advanced options ")],-1),Ht={id:"advancedOptions",class:"accordion-collapse collapse","aria-labelledby":"advancedOptionsHeader","data-bs-parent":"#advancedOptionsAccordion"},Kt={class:"accordion-body"},$t={class:"mb-3"},Bt=e("label",{for:"automatCAMKPEndpoint",class:"form-label"},"Automat CAM-KP Endpoint",-1);function qt(h,l,i,s,f,p){return n(),a("main",null,[Lt,e("div",kt,[Q(s.SearchCAMs,{automatCAMKPEndpoint:s.automatCAMKPEndpoint,changeSelectedModel:s.changeSelectedModel,changeSearchIds:s.changeSearchIds},null,8,["automatCAMKPEndpoint"]),Q(s.DisplayCAM,{"selected-model-u-r-l":s.selectedModelURL,"search-ids":s.searchIds},null,8,["selected-model-u-r-l","search-ids"])]),e("div",xt,[e("div",Dt,[Vt,e("div",Ht,[e("div",Kt,[e("form",null,[e("div",$t,[Bt,j(e("input",{type:"email",class:"form-control",id:"automatCAMKPEndpoint","aria-describedby":"emailHelp","onUpdate:modelValue":l[0]||(l[0]=t=>s.automatCAMKPEndpoint=t)},null,512),[[P,s.automatCAMKPEndpoint]])])])])])])])])}const Ft=G(Nt,[["render",qt]]);export{Ft as default};

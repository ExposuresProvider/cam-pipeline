import{d as B,r as p,c as Y,w as Q,o as n,a as l,b as e,e as S,f as c,t as a,F as y,g as I,n as N,p as X,h as Z,i as j,v as U,j as J,k as ee}from"./runtime-dom.esm-bundler.NfPSTE8u.js";function W(_){const o=_.toLowerCase();return o.startsWith("http://ctdbase.org/detail.go?type=relationship&ixnid=")?"CTD.REL:"+_.substring(53):o.startsWith("http://model.geneontology.org/")?"GO.MODEL:"+_.substring(30):o.startsWith("https://noctua.apps.renci.org/model/aop_")?"AOP:"+_.substring(40):_}const w=(_,o)=>{const i=_.__vccOpts||_;for(const[s,b]of o)i[s]=b;return i},te=B({__name:"DisplayCAM",props:{automatCAMKPEndpoint:{default:"https://automat.renci.org/cam-kp"},selectedModelURL:{},searchIds:{}},setup(_,{expose:o}){o();const i=_,s=p(!1),b=p([]),f=p([]),t=p({}),d=p({}),C=Y(()=>[...new Set(f.value.map(v=>v[0]).sort())]),k=Y(()=>[...new Set(f.value.map(v=>v[1]).sort())]);function x(v,A){return f.value.filter(g=>g[0]==v&&g[1]==A).map(g=>g[3]?`${g[2]} [${g[3]}]`:g[2]).sort()}Q(()=>i.selectedModelURL,(v,A)=>{v&&(b.value=[],f.value=[],t.value={},d.value={},P(v).then(g=>{b.value=g,g.map(h=>{f.value.push([h[0].id,h[2].id,h[3],h[4]]),t.value[h[0].id]=h[0].name,t.value[h[2].id]=h[2].name,d.value[h[0].id]=h[0].description,d.value[h[2].id]=h[2].description})}))});async function P(v){if(!v)return[];s.value=!0;const A=i.automatCAMKPEndpoint+"/cypher";let h=await(await fetch(A,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:`MATCH (s)-[p]-(o) WHERE '${v}' IN p.xref RETURN DISTINCT s, p, o, TYPE(p) AS pred_type, CASE
    WHEN startNode(p) = s THEN ''
    WHEN endNode(p) = s THEN 'reverse'
    ELSE ''
  END AS direction;`})})).json();s.value=!1;const M=h.results.flatMap(E=>E.data).map(E=>E.row);return console.log(M),M}const O={props:i,downloadInProgress:s,modelRows:b,spos:f,labels:t,descriptions:d,fromIds:C,toIds:k,getPredicates:x,getModelRows:P,get urlToID(){return W}};return Object.defineProperty(O,"__isScriptSetup",{enumerable:!1,value:!0}),O}}),r=_=>(X("data-v-84ba77f1"),_=_(),Z(),_),se={class:"col-8"},oe={key:0,class:"card my-2"},ne=r(()=>e("div",{class:"card-header"}," No model selected. Please search for one using the controls on the left. ",-1)),le=[ne],ae={key:1,class:"card my-2"},ie={class:"card-header"},ce=["href"],de={id:"edges",class:"card my-2"},re={class:"card-header"},ue=r(()=>e("strong",null,"Edges in selected CAM:",-1)),he=["href"],_e=r(()=>e("a",{href:"#relationships"},"Relationships",-1)),pe={key:0,class:"card-body"},me={class:"table table-bordered mb-2"},be=r(()=>e("thead",null,[e("tr",null,[e("th",null,"Subject"),e("th",null,"Edge"),e("th",null,"Object")])],-1)),fe=r(()=>e("br",null,null,-1)),ge=r(()=>e("br",null,null,-1)),ve=r(()=>e("em",null,"Description",-1)),Ce=r(()=>e("br",null,null,-1)),ye=r(()=>e("em",null,"Information Content",-1)),Me=r(()=>e("br",null,null,-1)),Ee=r(()=>e("em",null,"Equivalent identifiers",-1)),Ie={key:0},Se=r(()=>e("br",null,null,-1)),Ae={class:"overflow-auto",style:{height:"20em"}},Re=["href"],je=r(()=>e("br",null,null,-1)),Ue=r(()=>e("br",null,null,-1)),Pe=r(()=>e("em",null,"Description",-1)),Oe=r(()=>e("br",null,null,-1)),Te=r(()=>e("em",null,"Information Content",-1)),Ne=r(()=>e("br",null,null,-1)),ke=r(()=>e("em",null,"Equivalent identifiers",-1)),xe={class:"col-12"},De={id:"relationships",class:"card my-2"},Le={class:"card-header"},Ve=r(()=>e("strong",null,"Relationships in selected CAM:",-1)),He=["href"],$e=r(()=>e("a",{href:"#edges"},"Edges",-1)),Ke={key:0,class:"card-body"},qe={class:"table-responsive"},We={class:"table table-bordered table-hover"},Be=r(()=>e("th",{scope:"col"},"From CURIE",-1)),we=["title"],Ge=r(()=>e("br",null,null,-1)),Fe=r(()=>e("br",null,null,-1)),Ye=r(()=>e("br",null,null,-1));function Je(_,o,i,s,b,f){return n(),l(y,null,[e("div",se,[i.selectedModelURL?S("",!0):(n(),l("div",oe,le)),s.downloadInProgress?(n(),l("div",ae,[e("div",ie,[c(" Download of CAM "),e("a",{target:"cam",href:i.selectedModelURL},a(i.selectedModelURL),9,ce),c(" in progress ... ")])])):S("",!0),e("div",de,[e("div",re,[ue,c(),e("a",{target:"cam",href:i.selectedModelURL},a(i.selectedModelURL),9,he),c(" ("),_e,c(") ")]),s.downloadInProgress?S("",!0):(n(),l("div",pe,[e("table",me,[be,e("tbody",null,[(n(!0),l(y,null,I(s.modelRows,t=>(n(),l("tr",null,[e("td",{class:N(t[0].equivalent_identifiers.some(d=>i.searchIds.has(d))?"bg-success-subtle":"")},[e("strong",null,a(t[0].id),1),c(" "+a(t[0].name),1),fe,ge,ve,c(": "+a(t[0].description),1),Ce,ye,c(": "+a(t[0].information_content),1),Me,Ee,c(": "+a(t[0].equivalent_identifiers),1)],2),e("td",null,[e("strong",null,[c(a(t[3]),1),t[4]?(n(),l("span",Ie," ["+a(t[4])+"]",1)):S("",!0)]),Se,c(" biolink:primary_knowledge_source: "+a(t[1]["biolink:primary_knowledge_source"])+" ",1),e("ul",Ae,[(n(!0),l(y,null,I(t[1].xref,d=>(n(),l("li",{key:d},[e("a",{href:d,target:"xref"},a(s.urlToID(d)),9,Re)]))),128))])]),e("td",{class:N(t[2].equivalent_identifiers.some(d=>i.searchIds.has(d))?"bg-success-subtle":"")},[e("strong",null,a(t[2].id),1),c(" "+a(t[2].name),1),je,Ue,Pe,c(": "+a(t[2].description),1),Oe,Te,c(": "+a(t[2].information_content),1),Ne,ke,c(": "+a(t[2].equivalent_identifiers),1)],2)]))),256))])])]))])]),e("div",xe,[e("div",De,[e("div",Le,[Ve,c(),e("a",{target:"cam",href:i.selectedModelURL},a(i.selectedModelURL),9,He),c(" ("),$e,c(") ")]),s.downloadInProgress?S("",!0):(n(),l("div",Ke,[e("div",qe,[e("table",We,[e("thead",null,[e("tr",null,[Be,(n(!0),l(y,null,I(s.toIds,t=>(n(),l("th",{scope:"col",class:N(i.searchIds.has(t)?"bg-success-subtle":"")},[e("span",{title:s.descriptions[t]},a(t),9,we),Ge,c(a(s.labels[t]),1)],2))),256))])]),e("tbody",null,[(n(!0),l(y,null,I(s.fromIds,t=>(n(),l("tr",null,[e("td",{class:N(i.searchIds.has(t)?"bg-success-subtle":"")},[e("strong",null,a(t),1),c(" "+a(s.labels[t]),1),Fe,c(a(s.descriptions[t]),1)],2),(n(!0),l(y,null,I(s.toIds,d=>(n(),l("td",{class:N(i.searchIds.has(d)||i.searchIds.has(t)?"bg-success-subtle":"")},[(n(!0),l(y,null,I(s.getPredicates(t,d),C=>(n(),l("span",null,[c(a(C),1),Ye]))),256))],2))),256))]))),256))])])])]))])])],64)}const ze=w(te,[["render",Je],["__scopeId","data-v-84ba77f1"]]),Qe=B({__name:"SearchCAMs",props:{automatCAMKPEndpoint:{default:"https://automat.renci.org/cam-kp"},changeSelectedModel:{},changeSearchIds:{}},setup(_,{expose:o}){o();const i=_,s=p(""),b=p([]),f=p(""),t=p(""),d=p(""),C=p(""),k=p(""),x=p(100),P=p([]),O=p(!1);async function v(){O.value=!0,P.value=[];const h=f.value.split(/\s*,\s*/).filter(m=>m),M=t.value.split(/\s*,\s*/).filter(m=>m),E=C.value.split(/\s*,\s*/).filter(m=>m),R=d.value.split(/\s*,\s*/).filter(m=>m),D=new Set([...h,...M,...E,...R]);i.changeSearchIds(D);try{const m=await A(h,M,E,R,k.value,x.value);console.log(`Got ${m.length} CAM models: `,m),b.value=m}catch(m){P.value=m.message.split(`
`)}O.value=!1}async function A(h=[],M=[],E=[],R=[],D="",m=100){const L=[],V=[],H=[];if(h.length>0&&(M.length>0||R.length>0))throw new Error(`searchModels() cannot be called with both subjectOrObjectCURIEs (${h.length}) and either subjectCURIEs (${M.length}) or objectCURIEs (${R.length}).`);M&&L.push(...M.map(u=>`'${u}' IN s.equivalent_identifiers`)),R&&V.push(...R.map(u=>`'${u}' IN o.equivalent_identifiers`)),h&&H.push(...h.map(u=>`'${u}' IN s.equivalent_identifiers OR '${u}' IN o.equivalent_identifiers`));const $=[];E&&$.push(...E.map(u=>`TYPE(p) = '${u}'`));const T=[];L.length>0&&T.push(L.map(u=>`(${u})`).join(" OR ")),V.length>0&&T.push(V.map(u=>`(${u})`).join(" OR ")),$.length>0&&T.push($.map(u=>`(${u})`).join(" OR ")),H.length>0&&T.push(H.map(u=>`(${u})`).join(" AND ")),D&&T.push(`(ANY(url IN p.xref WHERE url STARTS WITH '${D.replaceAll("'","")}'))`);let K=`MATCH (s)-[p]-(o) RETURN DISTINCT p.xref, s, o, TYPE(p) AS pred_type LIMIT ${m}`;const G=T.join(" AND ");G.length>0&&(K=`MATCH (s)-[p]-(o) WHERE ${G} RETURN DISTINCT p.xref, s, o, TYPE(p) AS pred_type LIMIT ${m}`),console.log("Querying Cypher:",K);const z=i.automatCAMKPEndpoint+"/cypher";let q=await(await fetch(z,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:K})})).json();if(q.errors.length>0)throw Error(q.errors.map(u=>u.message).join(`
`));const F=q.results[0].data.flatMap(u=>({id:W(u.row[0][0]),urls:u.row[0],subj:u.row[1],obj:u.row[2],predicate:u.row[3]}));return console.log("rows",F),F}const g={props:i,selectedModelURL:s,results:b,subjectOrObjectCURIEsCSV:f,subjectCURIEsCSV:t,objectCURIEsCSV:d,predicateCURIEsCSV:C,modelStartsWith:k,limit:x,errors:P,inProgress:O,updateModelList:v,searchModels:A,get urlToID(){return W}};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}}),Xe={class:"col-4"},Ze={class:"card my-2"},et=e("div",{class:"card-header"},[e("strong",null,"Search CAM models")],-1),tt={class:"card-body"},st={key:0,class:"mb-3 p-1 border-1 bg-danger-subtle"},ot={class:"mb-3"},nt=e("label",{for:"predicateCURIEs",class:"form-label"},"Predicate CURIEs",-1),lt={class:"mb-3"},at=e("label",{for:"subjectOrObjectCURIEs",class:"form-label"},"Subject or Object CURIEs (items will be ANDed)",-1),it={class:"mb-3"},ct=e("label",{for:"subjectCURIEs",class:"form-label"},"Subject CURIEs",-1),dt={class:"mb-3"},rt=e("label",{for:"objectCURIEs",class:"form-label"},"Object CURIEs",-1),ut={class:"mb-3"},ht=e("label",{for:"modelStartsWith",class:"form-label"},"Model starts with",-1),_t=e("ul",null,[e("li",null,"Examples"),e("ul",{class:"small"},[e("li",null,[c("GO: "),e("code",null,"http://model.geneontology.org/")]),e("li",null,[c("CTD: "),e("code",null,"http://ctdbase.org/detail.go?type=relationship&ixnId=")]),e("li",null,[c("AOP: "),e("code",null,"https://noctua.apps.renci.org/model/AOP_")])])],-1),pt={class:"mb-3"},mt=e("label",{for:"limit",class:"form-label"},"Limit",-1),bt=e("em",null,"Search in progress",-1),ft=[bt],gt={class:"card my-2"},vt={class:"card-header"},Ct={class:"card-body p-0"},yt={class:"table table-bordered"},Mt=e("thead",null,[e("tr",null,[e("th",null,"Edges")])],-1),Et=["onClick"],It=["href"],St=e("a",{href:"#edges"},"Edges",-1),At=e("a",{href:"#relationships"},"Relationships",-1),Rt={key:0},jt={key:0},Ut={key:1};function Pt(_,o,i,s,b,f){return n(),l("div",Xe,[e("div",Ze,[et,e("div",tt,[s.errors.length>0?(n(),l("div",st,[e("ul",null,[(n(!0),l(y,null,I(s.errors,t=>(n(),l("li",null,a(t),1))),256))])])):S("",!0),e("div",ot,[nt,j(e("input",{type:"text",class:"form-control",id:"predicateCURIEs",placeholder:"biolink:affects, biolink:affected_by","onUpdate:modelValue":o[0]||(o[0]=t=>s.predicateCURIEsCSV=t)},null,512),[[U,s.predicateCURIEsCSV]])]),e("div",lt,[at,j(e("input",{type:"text",class:"form-control",id:"subjectOrObjectCURIEs",placeholder:"PUBCHEM.COMPOUND:5865, NCBIGene:2944","onUpdate:modelValue":o[1]||(o[1]=t=>s.subjectOrObjectCURIEsCSV=t)},null,512),[[U,s.subjectOrObjectCURIEsCSV]])]),e("div",it,[ct,j(e("input",{type:"text",class:"form-control",id:"subjectCURIEs",placeholder:"CHEMBL.COMPOUND:CHEMBL158, PUBCHEM.COMPOUND:5742832","onUpdate:modelValue":o[2]||(o[2]=t=>s.subjectCURIEsCSV=t)},null,512),[[U,s.subjectCURIEsCSV]])]),e("div",dt,[rt,j(e("input",{type:"text",class:"form-control",id:"objectCURIEs",placeholder:"CHEMBL.COMPOUND:CHEMBL158, PUBCHEM.COMPOUND:5742832","onUpdate:modelValue":o[3]||(o[3]=t=>s.objectCURIEsCSV=t)},null,512),[[U,s.objectCURIEsCSV]])]),e("div",ut,[ht,_t,j(e("input",{type:"text",class:"form-control",id:"modelStartsWith","onUpdate:modelValue":o[4]||(o[4]=t=>s.modelStartsWith=t)},null,512),[[U,s.modelStartsWith]])]),e("div",pt,[mt,j(e("input",{type:"text",class:"form-control",id:"limit","onUpdate:modelValue":o[5]||(o[5]=t=>s.limit=t)},null,512),[[U,s.limit]])]),s.inProgress?(n(),l("a",{key:1,onClick:o[6]||(o[6]=t=>s.updateModelList()),class:"btn btn-primary"},ft)):(n(),l("a",{key:2,onClick:o[7]||(o[7]=t=>s.updateModelList()),class:"btn btn-primary"},"Search"))])]),e("div",gt,[e("div",vt,[e("strong",null,"Search results ("+a(s.results.length)+")",1)]),e("div",Ct,[e("table",yt,[Mt,e("tbody",null,[(n(!0),l(y,null,I(s.results,t=>(n(),l(y,null,[(n(!0),l(y,null,I(t.urls,d=>(n(),l("tr",{onClick:C=>{s.selectedModelURL=d,i.changeSelectedModel(d)},class:N(s.selectedModelURL===d?"table-active":"")},[e("td",null,[c(a(s.urlToID(d))+" (",1),e("a",{href:d,target:"model-url"},"URL",8,It),c(", "),St,c(", "),At,c(") "),t.subj||t.predicate||t.obj?(n(),l("ul",Rt,[t.subj?(n(),l("li",jt,a(t.subj.id)+' ("'+a(t.subj.name)+'")',1)):S("",!0),e("li",null,a(t.predicate),1),t.obj?(n(),l("li",Ut,a(t.obj.id)+' ("'+a(t.obj.name)+'")',1)):S("",!0)])):S("",!0)])],10,Et))),256))],64))),256))])])])])])}const Ot=w(Qe,[["render",Pt]]),Tt=B({__name:"CAMKPFrontend",setup(_,{expose:o}){o();const i=p("https://automat.renci.org/cam-kp"),s=p(""),b=p(new Set);function f(C){s.value=C}function t(C){b.value=C}const d={automatCAMKPEndpoint:i,selectedModelURL:s,searchIds:b,changeSelectedModel:f,changeSearchIds:t,DisplayCAM:ze,SearchCAMs:Ot};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}}),Nt=ee('<div class="card my-2"><div class="card-header"><strong>CAM-KP Frontend</strong></div><div class="card-body"><p class="card-text"> The CAM-KP Frontend is intended to provide a frontend to the <a href="https://github.com/NCATSTranslator/Translator-All/wiki/CAM-Provider-KG">Causal Activity Models (CAM) Knowledge Graph (KG)</a>, as implemented in <a href="https://automat.renci.org/#/cam-kp">Automat CAM-KP</a>. </p><p class="card-text"><strong>Experimental and under development.</strong> Please report any issues to <a href="https://github.com/ExposuresProvider/cam-pipeline/issues">our GitHub repository</a>. </p></div></div>',1),kt={class:"row"},xt={class:"accordion",id:"advancedOptionsAccordion"},Dt={class:"accordion-item"},Lt=e("h2",{class:"accordion-header",id:"advancedOptionsHeader"},[e("button",{class:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#advancedOptions","aria-expanded":"false","aria-controls":"advancedOptions"}," Advanced options ")],-1),Vt={id:"advancedOptions",class:"accordion-collapse collapse","aria-labelledby":"advancedOptionsHeader","data-bs-parent":"#advancedOptionsAccordion"},Ht={class:"accordion-body"},$t={class:"mb-3"},Kt=e("label",{for:"automatCAMKPEndpoint",class:"form-label"},"Automat CAM-KP Endpoint",-1);function qt(_,o,i,s,b,f){return n(),l("main",null,[Nt,e("div",kt,[J(s.SearchCAMs,{automatCAMKPEndpoint:s.automatCAMKPEndpoint,changeSelectedModel:s.changeSelectedModel,changeSearchIds:s.changeSearchIds},null,8,["automatCAMKPEndpoint"]),J(s.DisplayCAM,{"selected-model-u-r-l":s.selectedModelURL,"search-ids":s.searchIds},null,8,["selected-model-u-r-l","search-ids"])]),e("div",xt,[e("div",Dt,[Lt,e("div",Vt,[e("div",Ht,[e("form",null,[e("div",$t,[Kt,j(e("input",{type:"email",class:"form-control",id:"automatCAMKPEndpoint","aria-describedby":"emailHelp","onUpdate:modelValue":o[0]||(o[0]=t=>s.automatCAMKPEndpoint=t)},null,512),[[U,s.automatCAMKPEndpoint]])])])])])])])])}const wt=w(Tt,[["render",qt]]);export{wt as default};
